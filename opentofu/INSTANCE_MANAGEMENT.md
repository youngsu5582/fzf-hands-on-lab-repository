# EC2 ì¸ìŠ¤í„´ìŠ¤ ê´€ë¦¬ ê°€ì´ë“œ

EC2 ì¸ìŠ¤í„´ìŠ¤ì˜ ìƒì„±, ì¤‘ì§€, ì‹œì‘, ì¬ì‹œì‘, ì‚­ì œë¥¼ ê´€ë¦¬í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.

**ì‚¬ìš© OS:** Ubuntu 22.04 LTS
**ê¸°ë³¸ ì‚¬ìš©ì:** ubuntu

## ğŸ“‹ ì „ì²´ ëª…ë ¹ì–´ ìš”ì•½

```bash
./scripts/create.sh      # ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
./scripts/connect.sh     # SSH ì ‘ì†
./scripts/status.sh      # ìƒíƒœ í™•ì¸
./scripts/stop.sh        # ì¸ìŠ¤í„´ìŠ¤ ì¤‘ì§€
./scripts/start.sh       # ì¸ìŠ¤í„´ìŠ¤ ì‹œì‘
./scripts/restart.sh     # ì¸ìŠ¤í„´ìŠ¤ ì¬ì‹œì‘
./scripts/destroy.sh     # ì¸ìŠ¤í„´ìŠ¤ ì™„ì „ ì‚­ì œ
```

---

## 1ï¸âƒ£ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±

```bash
cd opentofu
./scripts/create.sh
```

**ìƒì„±ë˜ëŠ” ê²ƒ:**
- EC2 ì¸ìŠ¤í„´ìŠ¤ (t2.micro)
- VPC, Subnet, Security Group
- Java 21 LTS
- Gradle 8.5
- sample-server (ìë™ ë¹Œë“œë¨)
- zsh, fzf, Oh My Zsh

**ì˜ˆìƒ ì‹œê°„:** ì•½ 3-5ë¶„

**í™•ì¸:**
```bash
./scripts/status.sh
```

---

## 2ï¸âƒ£ ì¸ìŠ¤í„´ìŠ¤ ì¤‘ì§€ (Stop)

**ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤:**
- ì‹¤ìŠµì´ ëë‚¬ì§€ë§Œ ë‚˜ì¤‘ì— ë‹¤ì‹œ ì‚¬ìš©í•  ì˜ˆì •
- ë¹„ìš© ì ˆê° (ì¤‘ì§€ ì‹œ EC2 ìš”ê¸ˆ ì—†ìŒ, EBSë§Œ ê³¼ê¸ˆ)
- ë°ì´í„°ëŠ” ìœ ì§€ë¨

```bash
./scripts/stop.sh
```

**ì…ë ¥:** `yes`

**íŠ¹ì§•:**
- âœ… ë°ì´í„° ë³´ì¡´ (ëª¨ë“  íŒŒì¼, ì„¤ì • ìœ ì§€)
- âœ… EC2 ì‹œê°„ë‹¹ ìš”ê¸ˆ ì¤‘ì§€
- âš ï¸ EBS ìŠ¤í† ë¦¬ì§€ ìš”ê¸ˆì€ ê³„ì† ë°œìƒ (ì›” $0.10/GB)
- âš ï¸ IP ì£¼ì†Œê°€ ë³€ê²½ë  ìˆ˜ ìˆìŒ (ì¬ì‹œì‘ ì‹œ)

**ì˜ˆìƒ ì‹œê°„:** ì•½ 30ì´ˆ ~ 1ë¶„

---

## 3ï¸âƒ£ ì¸ìŠ¤í„´ìŠ¤ ì‹œì‘ (Start)

**ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤:**
- ì¤‘ì§€ëœ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë‹¤ì‹œ ì‚¬ìš©
- ëª¨ë“  ë°ì´í„°ê°€ ê·¸ëŒ€ë¡œ ìœ ì§€ë¨

```bash
./scripts/start.sh
```

**íŠ¹ì§•:**
- âœ… ëª¨ë“  íŒŒì¼ê³¼ ì„¤ì •ì´ ê·¸ëŒ€ë¡œ ìœ ì§€
- âœ… Java, Gradle, sample-server ì¬ì„¤ì¹˜ ë¶ˆí•„ìš”
- âš ï¸ Public IPê°€ ë³€ê²½ë  ìˆ˜ ìˆìŒ
- âœ… ìŠ¤í¬ë¦½íŠ¸ê°€ ìë™ìœ¼ë¡œ ìƒˆ IP í™•ì¸

**ì˜ˆìƒ ì‹œê°„:** ì•½ 1-2ë¶„

**ì‹œì‘ í›„ í™•ì¸:**
```bash
./scripts/status.sh
./scripts/connect.sh
```

---

## 4ï¸âƒ£ ì¸ìŠ¤í„´ìŠ¤ ì¬ì‹œì‘ (Restart/Reboot)

**ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤:**
- ì‹œìŠ¤í…œ ì„¤ì • ë³€ê²½ í›„ ì ìš©
- ë¬¸ì œ í•´ê²° (ë©”ëª¨ë¦¬ ì •ë¦¬ ë“±)
- ì†Œí”„íŠ¸ì›¨ì–´ ì—…ë°ì´íŠ¸ í›„

```bash
./scripts/restart.sh
```

**ì…ë ¥:** `yes`

**íŠ¹ì§•:**
- âœ… ëª¨ë“  ë°ì´í„° ìœ ì§€
- âœ… IP ì£¼ì†Œ ìœ ì§€ (ë³€ê²½ ì•ˆ ë¨)
- âœ… ë¹ ë¥¸ ì¬ë¶€íŒ… (ì•½ 1-2ë¶„)

**ì˜ˆìƒ ì‹œê°„:** ì•½ 1-2ë¶„

---

## 5ï¸âƒ£ ì¸ìŠ¤í„´ìŠ¤ ì‚­ì œ (Destroy)

**ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤:**
- ì‹¤ìŠµ ì™„ì „ ì¢…ë£Œ
- ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
- ë¹„ìš© ì™„ì „ ì¤‘ì§€

```bash
./scripts/destroy.sh
```

**ì…ë ¥:** `yes`

**íŠ¹ì§•:**
- âŒ ëª¨ë“  ë°ì´í„° ì‚­ì œ (ë³µêµ¬ ë¶ˆê°€)
- âŒ EC2, VPC, Security Group ëª¨ë‘ ì‚­ì œ
- âœ… ëª¨ë“  ë¹„ìš© ì¤‘ì§€

**ì˜ˆìƒ ì‹œê°„:** ì•½ 2-3ë¶„

---

## ğŸ“Š ìƒíƒœ í™•ì¸

ì–¸ì œë“ ì§€ í˜„ì¬ ì¸ìŠ¤í„´ìŠ¤ ìƒíƒœë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```bash
./scripts/status.sh
```

**ì¶œë ¥ ì˜ˆì‹œ:**
```
=========================================
  EC2 Instance Status
=========================================

instance_id: i-0123456789abcdef0
instance_public_ip: 13.125.123.45
instance_public_dns: ec2-13-125-123-45.ap-northeast-2.compute.amazonaws.com
ssh_command: ssh -i fzf-lab-key.pem ec2-user@13.125.123.45
key_file: ./fzf-lab-key.pem
server_url: http://13.125.123.45:8080
actuator_health_url: http://13.125.123.45:8080/actuator/health

=========================================
```

---

## ğŸ”„ ì‹¤ìŠµ ì›Œí¬í”Œë¡œìš° ì˜ˆì‹œ

### ì‹œë‚˜ë¦¬ì˜¤ 1: í•˜ë£¨ ì‹¤ìŠµ

```bash
# ì˜¤ì „: ì‹œì‘
./scripts/create.sh          # ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
./scripts/connect.sh         # ì ‘ì†í•˜ì—¬ ì‹¤ìŠµ

# ì ì‹¬: ì ì‹œ ì¤‘ì§€
./scripts/stop.sh            # ì¤‘ì§€ (ë¹„ìš© ì ˆê°)

# ì˜¤í›„: ì¬ì‹œì‘
./scripts/start.sh           # ë‹¤ì‹œ ì‹œì‘
./scripts/connect.sh         # ì ‘ì†

# ì €ë…: ì™„ì „ ì¢…ë£Œ
./scripts/destroy.sh         # ì‚­ì œ
```

### ì‹œë‚˜ë¦¬ì˜¤ 2: ì¼ì£¼ì¼ í”„ë¡œì íŠ¸

```bash
# ì›”ìš”ì¼: ì´ˆê¸° ì„¤ì •
./scripts/create.sh

# í™”-ëª©: ë§¤ì¼ ì‚¬ìš©
./scripts/start.sh           # ì•„ì¹¨ì— ì‹œì‘
./scripts/stop.sh            # ì €ë…ì— ì¤‘ì§€

# ê¸ˆìš”ì¼: í”„ë¡œì íŠ¸ ì¢…ë£Œ
./scripts/destroy.sh
```

### ì‹œë‚˜ë¦¬ì˜¤ 3: ë°ëª¨/ë°œí‘œìš©

```bash
# ë°œí‘œ ì „ë‚ : ì¤€ë¹„
./scripts/create.sh
./scripts/connect.sh
# ì„œë²„ ì„¤ì •, ë°ì´í„° ì¤€ë¹„
./scripts/stop.sh            # ë°œí‘œ ì „ê¹Œì§€ ì¤‘ì§€

# ë°œí‘œ ë‹¹ì¼:
./scripts/start.sh           # ë°œí‘œ ì‹œì‘ ì „
# ë°œí‘œ ì§„í–‰
./scripts/stop.sh            # ë°œí‘œ ë

# ë°œí‘œ ë:
./scripts/destroy.sh         # ì •ë¦¬
```

---

## ğŸ’° ë¹„ìš© ë¹„êµ

### ì‹¤í–‰ ì¤‘ (Running)
- EC2 (t2.micro): í”„ë¦¬í‹°ì–´ 750ì‹œê°„/ì›” ë¬´ë£Œ
- EBS (30GB): í”„ë¦¬í‹°ì–´ 30GB ë¬´ë£Œ
- **ì´: $0** (í”„ë¦¬í‹°ì–´ ë‚´)

### ì¤‘ì§€ (Stopped)
- EC2: **$0** (ìš”ê¸ˆ ì—†ìŒ)
- EBS (30GB): í”„ë¦¬í‹°ì–´ 30GB ë¬´ë£Œ
- **ì´: $0** (í”„ë¦¬í‹°ì–´ ë‚´)

### ì‚­ì œ (Destroyed)
- **ì´: $0** (ëª¨ë“  ë¦¬ì†ŒìŠ¤ ì‚­ì œ)

**ğŸ’¡ íŒ:**
- í”„ë¦¬í‹°ì–´ ë‚´ì—ì„œëŠ” stop/startë¥¼ ììœ ë¡­ê²Œ ì‚¬ìš©í•´ë„ ë¹„ìš© ì—†ìŒ
- í•˜ì§€ë§Œ ì‚¬ìš©í•˜ì§€ ì•Šì„ ë•ŒëŠ” stop ê¶Œì¥ (ì‹¤ìˆ˜ ë°©ì§€)
- ì™„ì „íˆ ëë‚¬ìœ¼ë©´ destroy (ê¹”ë” ì •ë¦¬)

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

### 1. IP ì£¼ì†Œ ë³€ê²½
ì¤‘ì§€ í›„ ì¬ì‹œì‘í•˜ë©´ **Public IPê°€ ë³€ê²½**ë©ë‹ˆë‹¤.

```bash
# IP í™•ì¸
./scripts/status.sh
```

**í•´ê²°:**
- ìŠ¤í¬ë¦½íŠ¸ê°€ ìë™ìœ¼ë¡œ ìƒˆ IP í™•ì¸
- ì ‘ì† ì‹œ ìƒˆ IP ì‚¬ìš©

### 2. Stop vs Destroy êµ¬ë¶„

| ì‘ì—… | ë°ì´í„° | ë¹„ìš© | ë³µêµ¬ |
|------|--------|------|------|
| **Stop** | ìœ ì§€ âœ… | EBSë§Œ (í”„ë¦¬í‹°ì–´ ë¬´ë£Œ) | ê°€ëŠ¥ âœ… |
| **Destroy** | ì‚­ì œ âŒ | ì—†ìŒ âœ… | ë¶ˆê°€ëŠ¥ âŒ |

**ì˜ëª» destroy í–ˆë‹¤ë©´?**
- ë³µêµ¬ ë¶ˆê°€ëŠ¥
- `./scripts/create.sh`ë¡œ ìƒˆë¡œ ìƒì„± (ì¬ì„¤ì • í•„ìš”)

### 3. í”„ë¦¬í‹°ì–´ í•œë„
- **ì›” 750ì‹œê°„**: í•œ ë‹¬ ë‚´ë‚´ ì¼œë†”ë„ OK
- **í•˜ë£¨ 24ì‹œê°„**: ë§¤ì¼ ì‚¬ìš© ê°€ëŠ¥

---

## ğŸ” íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### 1. stop.sh ì‹¤í–‰ ì‹œ ì—ëŸ¬

```bash
# ìƒíƒœ ë¨¼ì € í™•ì¸
./scripts/status.sh

# ì´ë¯¸ stoppedë©´
./scripts/start.sh
```

### 2. start.sh í›„ IPê°€ ì•ˆ ë‚˜ì˜´

```bash
# ì ì‹œ ëŒ€ê¸° í›„ (1-2ë¶„)
./scripts/status.sh
```

### 3. connect.shë¡œ ì ‘ì† ì•ˆ ë¨

```bash
# ì¸ìŠ¤í„´ìŠ¤ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸
aws ec2 describe-instances \
    --instance-ids $(tofu output -raw instance_id) \
    --profile joyson \
    --region ap-northeast-2 \
    --query 'Reservations[0].Instances[0].State.Name'

# stoppedë©´ ì‹œì‘
./scripts/start.sh
```

---

## ğŸ¯ ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤

### âœ… ê¶Œì¥
1. ì‹¤ìŠµ ëë‚˜ë©´ **stop** (ë‚˜ì¤‘ì— ë‹¤ì‹œ ì‚¬ìš©í•  ì˜ˆì •)
2. ì™„ì „íˆ ëë‚¬ìœ¼ë©´ **destroy** (ë¹„ìš© ê±±ì • ì—†ìŒ)
3. ë§¤ì¼ ë°¤ **stop** (ì‹¤ìˆ˜ ë°©ì§€)
4. ìƒíƒœ ìì£¼ í™•ì¸ `./scripts/status.sh`

### âŒ ë¹„ê¶Œì¥
1. ì¸ìŠ¤í„´ìŠ¤ë¥¼ ê³„ì† ì¼œë‘ê³  ìŠì–´ë²„ë¦¼
2. destroy ì—†ì´ ë°©ì¹˜ (í”„ë¦¬í‹°ì–´ ì´ˆê³¼ ê°€ëŠ¥)
3. stop ì—†ì´ ì¥ê¸°ê°„ ë¯¸ì‚¬ìš©

---

## ğŸ“ ìš”ì•½

```bash
# ìƒì„±
./scripts/create.sh      # ìµœì´ˆ 1íšŒ

# ì¼ìƒ ì‚¬ìš©
./scripts/start.sh       # ì•„ì¹¨
./scripts/stop.sh        # ì €ë…

# ë¬¸ì œ í•´ê²°
./scripts/restart.sh     # ì¬ë¶€íŒ…
./scripts/status.sh      # ìƒíƒœ í™•ì¸

# ì™„ì „ ì¢…ë£Œ
./scripts/destroy.sh     # í”„ë¡œì íŠ¸ ë
```

**ê°„ë‹¨íˆ ì™¸ìš°ê¸°:**
- **Create** â†’ ìƒì„±
- **Start** â†’ ì‹œì‘
- **Stop** â†’ ì¤‘ì§€
- **Restart** â†’ ì¬ë¶€íŒ…
- **Destroy** â†’ ì‚­ì œ

---

## ğŸš€ sample-server ì‹¤í–‰ ë°©ë²•

ì¸ìŠ¤í„´ìŠ¤ ì ‘ì† í›„:

```bash
# SSH ì ‘ì†
./scripts/connect.sh

# ì„œë²„ ì‹¤í–‰ (EC2 ë‚´ë¶€ì—ì„œ)
~/start-server.sh

# ë˜ëŠ” ì§ì ‘
cd ~/fzf-hands-on-lab-repository/sample-server
./gradlew bootRun
```

**ì™¸ë¶€ì—ì„œ ì ‘ì†:**
```bash
# ë¡œì»¬ í„°ë¯¸ë„ì—ì„œ
curl http://<EC2_IP>:8080/actuator/health

# ë¸Œë¼ìš°ì €ì—ì„œ
http://<EC2_IP>:8080/actuator/health
```

**IP í™•ì¸:**
```bash
./scripts/status.sh
# server_url: http://13.125.123.45:8080
```

ì¦ê±°ìš´ ì‹¤ìŠµ ë˜ì„¸ìš”! ğŸ‰
